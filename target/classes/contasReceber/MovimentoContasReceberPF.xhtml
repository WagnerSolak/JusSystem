<ui:composition template="/WEB-INF/template/LayoutPadrao.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" xmlns:o="http://omnifaces.org/ui">

	<ui:define name="titulo">JusSystem</ui:define>

	<ui:define name="corpo">

		<f:metadata>
			<f:viewParam name="processoPF"
				value="#{cadastroProcessoPFBean.processoPF}" />
			<f:event listener="#{cadastroContasReceberPFBean.inicializar}"
				type="preRenderView" />
			
		</f:metadata>

		<p:focus />

		<h:form id="frmCR">

			<h1>Movimento Criação Contas a Receber de pessoa física</h1>

			<p:messages autoUpdate="true" closable="true" id="messages"/>

			<p:toolbar style="margin-top: 20px">
				<p:toolbarGroup>
				
					<p:commandButton value="Salvar" id="botaoSalvar"
						action="#{cadastroContasReceberPFBean.salvar}" 
						update="@form" process="@form"
							/>

				</p:toolbarGroup>

				<p:toolbarGroup align="right">
					<p:button value="Voltar"
						outcome="/contasReceber/CadastroContasReceberPF" />
					<p:separator />

					

				</p:toolbarGroup>
			</p:toolbar>


			<p:panelGrid columns="4" id="painelEstatico"
				style="widht: 100%; margin-top: 20px"
				columnClasses="rotulo, campo, rotulo, campo">

				<p:outputLabel value="Cliente" for="nome" />
				<p:outputLabel id="nome" size="100"
					value="#{cadastroProcessoPFBean.nomeCliente}" readonly="true"
					style="background:#DCDCDC;" />

				<p:outputLabel value="Data" />
				<p:outputLabel
					value="#{cadastroProcessoPFBean.processoPF.dataEntrada}"
					style="background:#DCDCDC;">
					<f:convertDateTime pattern="dd/MM/yyyy" />
				</p:outputLabel>

				<p:outputLabel value="Número do Processo" for="numeroProcesso" />
				<p:outputLabel
					value="#{cadastroProcessoPFBean.processoPF.numeroProcesso}"
					id="numeroProcesso" size="20" readonly="true"
					style="background:#DCDCDC;" />

				<p:outputLabel value="Valor Recebimento Escritório"
					for="valorRecebe" />
				<p:outputLabel
					value="#{cadastroProcessoPFBean.processoPF.valorRecebimentoProcesso}"
					id="valorRecebe" readonly="true" style="background:#DCDCDC;">
					<f:convertNumber type="currency" />
				</p:outputLabel>




			</p:panelGrid>

			<p:panelGrid columns="2" id="painel"
				style="widht: 100%; margin-top: 20px" columnClasses="rotulo, campo">
				
				<p:outputLabel value="Cliente Pessoa Física *" for="pessoaFisica" />
				<h:panelGroup>
					<p:inputText id="pessoaFisica" size="54"
						value="#{cadastroContasReceberPFBean.nomeCliente}"
						readonly="#{facesContext.currentPhaseId.name eq 'RENDER_RESPONSE'}" />

					<p:commandButton icon="ui-icon-search" title="Pesquisar"
						process="@this" action="#{selecaoClientePessoaFisicaBean.abrirDialogo}"
						ignoreAutoUpdate="true">
						<p:ajax event="dialogReturn"
							listener="#{cadastroContasReceberPFBean.clienteSelecionado}"
							update="pessoaFisica" />
					</p:commandButton>
				</h:panelGroup>
				
				
				<p:outputLabel value="Condição Pagamento *" for="condi" />
				<p:autoComplete id="condi"  dropdown="true"
					value="#{cadastroContasReceberPFBean.contasReceberPF.condicaoDePagamento}" 
					completeMethod="#{cadastroContasReceberPFBean.completarCondicaoDePagamento}"
					var="condicao" itemLabel="#{condicao.descricao}" itemValue="#{condicao}" 
					forceSelection="true" />
					
				

				<p:outputLabel value="Quantidade de Parcelas" for="parcelas" 
					rendered="#{cadastroProcessoPFBean.processoPF.comParcelamento}"/>
				<p:spinner id="parcelas" size="22" min="1"
					value="#{cadastroProcessoPFBean.processoPF.qtdParcela}"
					rendered="#{cadastroProcessoPFBean.processoPF.comParcelamento}">

					<p:ajax event="change" 
					listener="#{cadastroProcessoPFBean.processoPF.gerarParcela(cadastroProcessoPFBean.processoPF.qtdParcela)}"
					update="contasReceberTable"/>
				</p:spinner>
			</p:panelGrid>

			<p:dataTable id="contasReceberTable" var="contasReceber"
				style="margin-top: 20px" emptyMessage="Nenhuma parcela para adicionar na tabela."
				scrollable="true" scrollHeight="100" editable="true" editMode="cell"
				value="#{cadastroProcessoPFBean.processoPF.contasReceberPF}">

				<p:column headerText="Nr. Parcela"
					style="text-align: center; width: 90px">
					<p:outputLabel value="#{contasReceber.numeroParcela}" />
				</p:column>

				<p:column headerText="Valor" style="color: black">
						<p:cellEditor>

						<f:facet name="output">
							<p:outputLabel value="#{contasReceber.valorTotal}"
								style="color: black">
								<f:convertNumber currencySymbol="R$" type="currency"
									maxFractionDigits="2" minFractionDigits="2" />
							</p:outputLabel>
						</f:facet>

						<f:facet name="input">
							<p:inputText value="#{contasReceber.valorTotal}" label="val"
								styleClass="moeda" 
								rendered="#{cadastroProcessoPFBean.processoPF.comParcelamento}">
								<f:convertNumber maxFractionDigits="2" minFractionDigits="2" />
								<f:ajax event="change" render="contasReceberTable"
									listener="#{cadastroProcessoPFBean.processoPF.recalcularParcela()}" />
							</p:inputText>
						</f:facet>

					</p:cellEditor>
				</p:column>

				<p:column headerText="Vencimento">

					<p:cellEditor>

						<f:facet name="output">
							<h:outputText value="#{contasReceber.dataVencimento}">
								<f:convertDateTime pattern="dd/MM/yyyy" />
							</h:outputText>
						</f:facet>

						<f:facet name="input">
							<p:calendar value="#{contasReceber.dataVencimento}"
								rendered="#{cadastroProcessoPFBean.processoPF.comParcelamento}"
								label="vencimento" showOn="false" locale="pt"
								pattern="dd/MM/yyyy" mask="true">
							</p:calendar>
						</f:facet>

					</p:cellEditor>

				</p:column>

			</p:dataTable>

		</h:form>
	</ui:define>
</ui:composition>

